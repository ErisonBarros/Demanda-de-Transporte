---
title: "Panel Data Models"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      fig.path = "README_files/7-PanelModels/")
```

#### EXAMPLE EXERCISE: Grunfeld Investment data. This data consists of 10 large US manufacturing firms from 1935 to 1954.

>**Your Task:** Analyze the many types of panel models.

This code was developed based on the paper: Croissant, Y., Milo, G.(2008). Panel Data Econometrics in R: The plm Package, Journal of Statistical Software, 27(2).

## Data
#### Variables:  

* `invest`: Gross investment, defined as additions to plant and equipment plus maintenance and repairs in millions of dollars deflated by the implicit price deflator of producers' durable equipment (base 1947);  
* `value`: Market value of the firm, defined as the price of common shares at December 31 (base 1947);
* `capital`: Stock of plant and equipment, defined as the accumulated sum of net additions to plant and equipment deflated by the implicit price deflator for producers' durable equipment (base 1947);
* `firm`: General Motors (GM), US Steel (US), General Electric (GE), Chrysler (CH), Atlantic Rening (AR), IBM, Union Oil (UO), Westinghouse (WH), Goodyear (GY), Diamond Match (DM), American Steel (AS);
* `year`: Year of data; 
* `firmcod`: Numeric code that identifies each firm.

## Let's start!
#### Import libraries
```{r}
library(readxl) #read excel files
library(skimr) #summary statistics
library(foreign) #panel data models
library(plm) # Lagrange multiplier test and panel models
```

### Get to know your dataset
##### Import dataset
```{r}
data <- read_excel("Data/Grunfeld_data.xlsx")
```

##### Transform dataset into dataframe
```{r}
df <- data.frame(data)
```

##### Take a first look at your data
```{r}
head(df)
```

##### Check summary statistics of variables
```{r}
skim(df)
```

##### Take out the "firmcod" from the dataset
```{r}
drop <- c("firmcod")
df = df[,!(names(df) %in% drop)]
```

##### First run an Ordinary least square model. Compare the results from this model to the many panel data models

```{r}
mlr = lm(invest ~ value + capital, data = df)
summary(mlr)
```

## Now let's run Panel models.

Panel data models use _one way_ and _two way_ component models to overcome heterogeneity, correlation in the disturbance terms, and heteroscedasticity.

* **One way error component model:** variable-intercept models across individuals **or** time;
* **Two way error component model:** variable-intercept models across individuals **and** time. 

Modelling Specifications: 

* **With fixed-effects:** effects that are in the sample. Fixed-effects explore the causes of change within a person or entity (In this example the entity is the _firms_);

* **With random-effects:** effect randomly drawn from a population. The random effects model is an appropriate specification if we are drawing _n_ individuals randomly from a large population.


##### One way fixed effects model
```{r}
fixed = plm(invest ~ value + capital, data = df, index = c("firm", "year"), model = "within")
summary(fixed)
```

##### One way random effects model

```{r}
random = plm(invest ~ value + capital, data = df, index = c("firm", "year"), model = "random")
summary(random)
```

You can also try other types of model estimation: 

```{r echo=FALSE, warning=TRUE}
model <-c ("Fixed effects", "Pooling model", "First-diference model", "Between model", "Random effects")
code <-c("within", "pooling", "fd", "between", "random")
table <- data.frame(model,code)
knitr::kable(table, align = "l")
```


##### Use the Hausman test to evaluate when to use fixed or random effects

```{r}
phtest(random, fixed)
```

> **Note:** The null hypothesis is that random effect model is more appropriate than the fixed effect model. 


#### Two-way Fixed effects model

```{r}
fixed_tw <- plm(invest ~ value + capital, data = df, effect = "twoways", model = "within", index = c("firm", "year"))
summary(fixed_tw)
```

#### Two-way Random effects model

```{r}
random_tw <- plm(invest ~ value + capital, data = df, effect = "twoways", model = "random", index = c("firm", "year"), random.method = "amemiya")
summary(random_tw)
```

#### Lagrange Multiplier Test

```{r}
plmtest(random_tw)
```

>**Note:** The Lagrange multiplier statistic, is used to test the null hypothesis that there are no group effects in the Random Effects model. 

>**Note:** Large values of the Lagrange Multiplier indicate that effects model is more suitable than the classical model with no common effects.

>**Note:** Large values of H indicate that the fixed effects model is prefered over the random effects model. While, A large value of the LM statistic in the presence of a small H statistic indicate that the random effects model is more suitable.